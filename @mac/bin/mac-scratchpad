#!/usr/bin/env bash

function create_scratchpad() {
  if [ ! -x $(command -v alacritty) ]; then
    echo "Could not find alacritty binary"
    exit 1
  fi

  alacritty --title scratchpad &
}

scratchpad_id=$(yabai -m query --windows | jq '.[] | select(.title=="scratchpad").id')

if [[ "$scratchpad_id" -lt 1 ]]; then
  sleep 1
  create_scratchpad
  code=$?
  if [ $code != 0 ]; then
    exit 1
  fi
  sleep 1
  scratchpad_id=$(yabai -m query --windows | jq '.[] | select(.title=="scratchpad").id')
  yabai -m window --focus "$scratchpad_id"
  yabai -m window --toggle float
  yabai -m window --toggle topmost
  yabai -m window --resize abs:722:402
  yabai -m window --move abs:443:265
else
  is_minimized=$(yabai -m query --windows --window "$scratchpad_id" | jq '.minimized')
  current_space=$(yabai -m query --spaces --space | jq '.index')

  if [[ "$is_minimized" -eq 1 ]]; then
    yabai -m window "$scratchpad_id" --space "$current_space"
    yabai -m window --focus "$scratchpad_id"
    yabai -m window --move abs:443:265
  else
    yabai -m window "$scratchpad_id" --minimize
  fi
fi
